<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thparq Library Validation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .box {
            display: inline-block;
            width: 100px;
            height: 100px;
            margin: 10px;
            background: #e0e0e0;
            border: 2px solid #999;
            text-align: center;
            line-height: 100px;
            transition: all 0.3s;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #0056b3;
        }
        .highlight {
            background: yellow !important;
        }
        .hidden {
            display: none;
        }
        .active {
            border-color: #ff0000 !important;
            border-width: 4px !important;
        }
        .ready {
            opacity: 0.8;
        }
        .faq {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .question {
            cursor: pointer;
            color: #007bff;
            margin: 0;
        }
        .question:hover {
            text-decoration: underline;
        }
        .answer {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        .link {
            color: #007bff;
            text-decoration: none;
            margin: 0 5px;
        }
        .output {
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin: 10px 0;
            min-height: 50px;
        }
        .name {
            font-weight: bold;
            color: #333;
        }
        .spark {
            display: inline-block;
            padding: 20px;
            background: linear-gradient(45deg, #ffeb3b, #ff9800);
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: sparkle 2s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <h1>✨ Thparq Library Validation Test Suite</h1>
    <div class="spark">We put the thpark back in your vanilla JS!</div>
    <p>Testing all functions from the compressed inline version - now with the lithp!</p>

    <!-- Test Elements -->
    <div class="test-section">
        <h2>Test Elements</h2>
        <div class="box">Box 1</div>
        <div class="box">Box 2</div>
        <div class="box">Box 3</div>
        <div class="box hidden">Box 4</div>
        
        <br>
        
        <button class="btn">Button 1</button>
        <button class="btn">Button 2</button>
        <button class="btn">Button 3</button>
        
        <br><br>
        
        <a href="https://example.com" class="link">Link 1</a>
        <a href="https://google.com" class="link">Link 2</a>
        
        <div class="output"></div>
        
        <div class="name"></div>
        
        <div class="faq">
            <h3 class="question">What is thparq?</h3>
            <p class="answer hidden">A micro DOM utility library!</p>
        </div>
        
        <div class="faq">
            <h3 class="question">How does it work?</h3>
            <p class="answer hidden">It provides jQuery-like syntax for vanilla JS!</p>
        </div>
    </div>

    <!-- Test Results -->
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <script>
        // thparq injection, see https://github.com/stimpy77/thparq/
        const _$ogpo=Object.getPrototypeOf;const _$ospo=Object.setPrototypeOf;const _$nlp=NodeList.prototype;const $=t=>{if("string"==typeof t){let e=document.querySelectorAll(t);return _$ogpo(e).$eon||_$ospo(e,_$nlp),e}if(t instanceof Node){let o=[t];return _$ogpo(o).$eon||_$ospo(o,_$nlp),o}if(t instanceof NodeList)return _$ogpo(t).$eon||_$ospo(t,_$nlp),t;let r=[];return _$ospo(r,_$nlp),r},$ea=(t,e)=>($(t).forEach(e),$(t)),$eon=(t,e,o)=>($(t).forEach(t=>t.addEventListener(e,o)),$(t)),$addClass=(t,e)=>($(t).forEach(t=>t.classList.add(e)),$(t)),$removeClass=(t,e)=>($(t).forEach(t=>t.classList.remove(e)),$(t)),$toggleClass=(t,e)=>($(t).forEach(t=>t.classList.toggle(e)),$(t)),$css=(t,e)=>($(t).forEach(t=>Object.assign(t.style,e)),$(t)),$attr=(t,e,o)=>void 0===o?$(t)[0]?.getAttribute(e):($(t).forEach(t=>t.setAttribute(e,o)),$(t)),$html=(t,e)=>void 0===e?$(t)[0]?.innerHTML:($(t).forEach(t=>t.innerHTML=e),$(t)),$text=(t,e)=>void 0===e?$(t)[0]?.textContent:($(t).forEach(t=>t.textContent=e),$(t)),$get=t=>fetch(t).then(t=>t.text()),$getJSON=t=>fetch(t).then(t=>t.json()),$1st=t=>$(t)[0]||null,$1ast=t=>$(t)[$(t).length-1]||null,$len=t=>$(t).length;_$nlp.$ea=function(t){return $ea(this,t)},_$nlp.$eon=function(t,e){return $eon(this,t,e)},_$nlp.$addClass=function(t){return $addClass(this,t)},_$nlp.$removeClass=function(t){return $removeClass(this,t)},_$nlp.$toggleClass=function(t){return $toggleClass(this,t)},_$nlp.$css=function(t){return $css(this,t)},_$nlp.$attr=function(t,e){return $attr(this,t,e)},_$nlp.$html=function(t){return $html(this,t)},_$nlp.$text=function(t){return $text(this,t)},_$nlp.$len=function(){return $len(this)};


        // Test runner
        const results = document.getElementById('results');
        let testCount = 0;
        let passedCount = 0;

        function logTest(name, success, details = '') {
            testCount++;
            if (success) passedCount++;
            
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${success ? '✓' : '✗'} ${name}</strong>${details ? ': ' + details : ''}`;
            results.appendChild(div);
        }

        // Run tests
        try {
            // Test $() - Select elements
            const boxes = $('.box');
            logTest('$() - Select elements', boxes.length === 4, `Found ${boxes.length} boxes`);

            // Test $1st() - First match
            const firstBox = $1st('.box');
            logTest('$1st() - First match', firstBox && firstBox.textContent.trim() === 'Box 1', 'Got first box');

            // Test $1ast() - Last match
            const lastBox = $1ast('.box');
            logTest('$1ast() - Last match', lastBox && lastBox.textContent.trim() === 'Box 4', 'Got last box (hidden)');

            // Test $len() - Get length
            const boxCount = $len('.box');
            logTest('$len() - Get length', boxCount === 4, `Count: ${boxCount}`);

            // NEW TEST: $ea() with direct selector string
            let eaDirectTest = true;
            const originalTexts = Array.from($('.box')).map(el => el.textContent); // Save original state
            $ea('.box', (el, i) => {
                el.dataset.test = `Box ${i+1}`;
                if (el.dataset.test !== `Box ${i+1}`) eaDirectTest = false;
            });
            logTest('$ea() - Direct selector string', eaDirectTest, 'Can pass selector directly');
            // Restore
            $('.box').forEach((el, i) => el.textContent = originalTexts[i]);


            // Test $eon() with direct selector string
            let eonDirectTest = false;
            $eon('.btn', 'click', function () {
                eonDirectTest = true;
                this.style.background = '#28a745';
            });
            document.querySelector('.btn').click();
            logTest('$eon() - Direct selector string', eonDirectTest, 'Event attached with selector string');

            // Test $addClass() with direct selector string
            $addClass('.box', 'highlight');
            const highlighted = document.querySelectorAll('.box.highlight').length;
            logTest('$addClass() - Direct selector string', highlighted === 4, 'All boxes highlighted');
            

            // Test $removeClass() with direct selector string
            $removeClass('.box', 'highlight');
            const noTestClass = document.querySelectorAll('.box.highlight').length;
            logTest('$removeClass() - Direct selector string', noTestClass === 0, 'Class removed with selector');

            // Test $toggleClass() with direct selector string
            $toggleClass('.box:first-of-type', 'active');
            const hasActive = document.querySelector('.box.active') !== null;
            $toggleClass('.box:first-of-type', 'active'); // cleanup
            logTest('$toggleClass() - Direct selector string', hasActive, 'Active class toggled');

            // Test $css() with direct selector string
            $css('.box:nth-child(2)', {
                backgroundColor: 'gold',
                transform: 'scale(1.05)'
            });
            const styledBox = document.querySelector('.box:nth-child(2)');
            const hasStyles = styledBox.style.backgroundColor === 'gold';
            logTest('$css() - Direct selector string', hasStyles, 'CSS applied with selector');

            // Test $attr() - Set with direct selector string
            $attr('.link', 'target', '_blank');
            const hasTarget = document.querySelector('.link').getAttribute('target') === '_blank';
            logTest('$attr() - Set with selector string', hasTarget, 'Target attribute set');

            // Test $html() - Get with direct selector string
            const originalHtml = $html('.output');
            $html('.output', '<strong>Test HTML</strong>');
            const htmlContent = $html('.output');
            logTest('$html() - Get with selector string', htmlContent === '<strong>Test HTML</strong>', 'HTML get works');
            $html('.output', originalHtml); // cleanup

            // Test $text() - Get/Set with direct selector string
            const originalText = $text('.output');
            $text('.output', 'Test Text');
            const textContent = $text('.output');
            logTest('$text() - Get/Set with selector string', textContent === 'Test Text', 'Text get/set works');
            $text('.output', originalText); // cleanup

            // Test chaining methods still work
            $('.box').$addClass('ready');
            const readyBoxes = document.querySelectorAll('.box.ready').length;
            logTest('Chaining - $addClass()', readyBoxes === 4, 'Chaining still works');
            $('.box').$removeClass('ready'); // cleanup

            // Test $attr() - Get (from README example)
            const href = $attr($('.link'), 'href');
            logTest('$attr() - Get with wrapped elements', href === 'https://example.com', `Got href: ${href}`);

            // Test FAQ example - Chaining style
            $('.question').$eon('click', function () {
                $(this.nextElementSibling).$toggleClass('hidden');
            });
            
            // Test click on FAQ
            const firstQuestion = document.querySelector('.question');
            const firstAnswer = firstQuestion.nextElementSibling;
            const wasHidden = firstAnswer.classList.contains('hidden');
            firstQuestion.click();
            const isNowVisible = !firstAnswer.classList.contains('hidden');
            logTest('FAQ Example - Chaining', wasHidden && isNowVisible, 'FAQ toggle works');
            firstQuestion.click(); // toggle back

            // Test FAQ example - Non-chaining style with array
            const questions = document.querySelectorAll('.question');
            $eon($(questions[1]), 'click', function () {
                $toggleClass([this.nextElementSibling], 'hidden');
            });
            
            const secondQuestion = questions[1];
            const secondAnswer = secondQuestion.nextElementSibling;
            const wasHidden2 = secondAnswer.classList.contains('hidden');
            secondQuestion.click();
            const isNowVisible2 = !secondAnswer.classList.contains('hidden');
            logTest('FAQ Example - Non-chaining', wasHidden2 && isNowVisible2, 'FAQ with array works');

            // Test complex chaining from README
            let complexChainWorks = true;
            const box3Original = $('.box:nth-child(3)')[0].innerHTML;
            try {
                $('.box:nth-child(3)')
                    .$addClass('ready')
                    .$css({ color: 'lime' })
                    .$ea((el, i) => (el.dataset.index = i))
                    .$html('<strong>Updated</strong>');
                
                const testBox = document.querySelector('.box:nth-child(3)');
                complexChainWorks = testBox.classList.contains('ready') && 
                                  testBox.style.color === 'lime' &&
                                  testBox.innerHTML === '<strong>Updated</strong>' &&
                                  testBox.dataset.index === '0';
            } catch (e) {
                complexChainWorks = false;
            }
            logTest('Complex Chaining Example', complexChainWorks, 'Full chain from README works');
            $('.box:nth-child(3)')[0].innerHTML = box3Original; // cleanup
            $('.box:nth-child(3)')[0].removeAttribute('style');
            $('.box:nth-child(3)')[0].classList.remove('ready');


            // Test with NodeList/Element directly
            const directBoxes = document.querySelectorAll('.box');
            $addClass(directBoxes, 'test-direct');
            const hasDirect = document.querySelectorAll('.box.test-direct').length === 4;
            logTest('Direct NodeList usage', hasDirect, 'Works with DOM elements directly');
            $removeClass(directBoxes, 'test-direct'); // cleanup

            // Test edge case: empty selector
            const emptyResult = $('.non-existent');
            logTest('Empty selector result', emptyResult.length === 0, 'Returns empty NodeList');

            // Test that methods handle empty selections gracefully
            let noError = true;
            try {
                $addClass('.non-existent', 'test');
                $css('.non-existent', { color: 'red' });
                $text('.non-existent', 'test');
            } catch (e) {
                noError = false;
            }
            logTest('Empty selection handling', noError, 'Methods handle empty selections gracefully');

            // Test $get() - Promise-based fetch
            $get('data:text/plain;base64,SGVsbG8gV29ybGQ=') // "Hello World" base64
                .then(data => {
                    logTest('$get() - Fetch text', data === 'Hello World', 'Fetched text data successfully');
                })
                .catch(e => {
                    logTest('$get() - Fetch text', false, 'Failed to fetch text: ' + e.message);
                });

            // Test $getJSON() - Promise-based JSON fetch
            $getJSON('data:application/json;base64,eyJtZXNzYWdlIjoiaGVsbG8ifQ==') // {"message":"hello"} base64
                .then(data => {
                    logTest('$getJSON() - Fetch JSON', data.message === 'hello', 'Fetched JSON data successfully');
                })
                .catch(e => {
                    logTest('$getJSON() - Fetch JSON', false, 'Failed to fetch JSON: ' + e.message);
                });

        } catch (e) {
            logTest('Critical Error', false, e.message);
        }

        // Summary
        const summary = document.createElement('div');
        summary.className = 'summary';
        summary.innerHTML = `<h2>Thummary: ${passedCount}/${testCount} tethts paththed!</h2>`;
        results.appendChild(summary);

        const note = document.createElement('p');
        note.innerHTML = 'Note: $get() and $getJSON() require a therver environment to tetht properly. They are promithe-bathed fetch wrapperth.';
        results.appendChild(note);

        const status = document.createElement('p');
        status.innerHTML = '✨ Thpark Status: All non-chaining examples now accept direct thelector thtrings! Thith maketh the API even more conthise and jQuery-like!';
        results.appendChild(status);
    </script>
</body>
</html>
